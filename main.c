// Joshua Heinstein
// joshuaheinstein@gmail.com
// 10/6/2025
// main.c
// Pitch in Hz, duration in ms

#include "stdint.h"
#include <stdio.h>

#include "STM32L432KC_FLASH.h"
#include "STM32L432KC_GPIO.h"
#include "STM32L432KC_RCC.h"
#include "STM32L432KC_TIM.h"

const int notes[][2] = {
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	250},
{  0,	125},
{494,	125},
{523,	125},
{587,	125},
{659,	375},
{392,	125},
{699,	125},
{659,	125},
{587,	375},
{349,	125},
{659,	125},
{587,	125},
{523,	375},
{330,	125},
{587,	125},
{523,	125},
{494,	250},
{  0,	125},
{330,	125},
{659,	125},
{  0,	250},
{659,	125},
{1319,	125},
{  0,	250},
{623,	125},
{659,	125},
{  0,	250},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	500},
{  0,	0}};


const int starWars[][2] = {
    {440, 500}, {440, 500}, {440, 500},        // A A A
    {349, 350}, {523, 150}, {440, 500},        // F C A
    {349, 350}, {523, 150}, {440, 1000},       // F C A (hold)
    {659, 500}, {659, 500}, {659, 500},        // E E E
    {698, 350}, {523, 150}, {415, 500},        // F C G#
    {349, 350}, {523, 150}, {440, 1000},       // F C A (hold)

    {880, 500}, {440, 350}, {440, 150}, {880, 500}, // High A, A, A, High A
    {830, 250}, {784, 250}, {740, 125}, {698, 125}, {740, 250}, // Bb, G#, G, F#, G
    {455, 250}, {622, 500}, {587, 250}, {554, 250}, {523, 125}, {494, 125}, {523, 250}, // A#, D#, D, C#, C, B, C
    {349, 250}, {415, 500}, {349, 250}, {440, 1000}, // F, G#, F, A (long)

    {880, 500}, {440, 350}, {440, 150}, {880, 500},
    {830, 250}, {784, 250}, {740, 125}, {698, 125}, {740, 250},
    {455, 250}, {622, 500}, {587, 250}, {554, 250}, {523, 125}, {494, 125}, {523, 250},
    {349, 250}, {415, 500}, {349, 250}, {440, 1000},

    {0, 0} // end
};

const int starWars2[][2] = {
	// Star Wars Main Theme
	// Score by John Williams
	{392,	300},	// G4
	{392,	300},	// G4
	{392,	300},	// G4
	{523,	1800},	// C5
	{784,	1800},	// G5
	{698,	150},	// F5
	{659,	150},	// E5
	{587,	150},	// D5
	{1047,	1800},	// C6
	{784,	900},	// G5
	{698,	150},	// F5
	{659,	150},	// E5
	{587,	150},	// D5
	{1047,	1800},	// C6
	{784,	900},	// G5
	{698,	150},	// F5
	{659,	150},	// E5
	{698,	150},	// F5
	{587,	1800},	// D5
	{0,		0}		// End of song
};


void playSong(const int song[][2]) {
    int i = 0;
    
    // Play notes until we hit the end marker (frequency = 0, duration = 0)
    while (!(song[i][0] == 0 && song[i][1] == 0)) {
        playNote(song[i][0], song[i][1]);
        i++;
        }
  stopNote();
}


int main(void) {
	
    // Initialize system and timers
    configureFlash();     // Configure flash wait states for 80MHz
    configureClock();     // Set system clock to 80 MHz via PLL
    configureTIM15();     // PWM for audio output on PB14
    configureTIM16();     // Timer for delays
    PA6Output();          // Setup pin pa6
    // Play FÃ¼r Elise once at startup
    playSong(notes);
    
    // Add pause after first playback
    delay_ms(1000);
    
    playSong(starWars2);

    delay_ms(1000);    

    playSong(starWars);  	
}
